/*
 * buzzer.cpp
 *
 *  Created on: Feb 12, 2024
 *      Author: mmaakkyyii
 */
#include "tim.h"

void setBuzzerFrequency(float frequency) {
	if(frequency<0){
		__HAL_TIM_SET_COMPARE(&htim12, TIM_CHANNEL_1, 0);
	}
    uint32_t timerClock = HAL_RCC_GetPCLK1Freq();  // タイマ�????????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��??????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��のクロ???????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��??????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?ク周波数を取???????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��??????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?
    uint32_t prescaler = htim12.Init.Prescaler;     // 現在のプリスケーラ値を取???????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��??????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?????��?��??��?��???��?��??��?��????��?��??��?��???��?��??��?��?
    uint32_t period = (timerClock / (prescaler + 1)) / frequency - 1;

    __HAL_TIM_SET_AUTORELOAD(&htim12, period);
    __HAL_TIM_SET_COMPARE(&htim12, TIM_CHANNEL_1, period / 5);  // 50% duty cycle
}


